<?xml version="1.0" encoding="utf-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -1 1600 2720" width="1600px" height="2720px">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#333"/>
    </marker>
    <marker id="arrowhead-yes" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#28a745"/>
    </marker>
    <marker id="arrowhead-no" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#dc3545"/>
    </marker>
    <style>
  .title { font-family: Arial, sans-serif; font-size: 28px; font-weight: bold; fill: #1a1a1a; }
  .subtitle { font-family: Arial, sans-serif; font-size: 18px; fill: #555; }
  .box-text { font-family: Arial, sans-serif; font-size: 15px; fill: #1a1a1a; text-anchor: middle; }
  .box-text-small { font-family: Arial, sans-serif; font-size: 13px; fill: #1a1a1a; text-anchor: middle; }
  .box-label { font-family: Arial, sans-serif; font-size: 14px; font-weight: bold; fill: #1a1a1a; }
  .decision { fill: #fff3cd; stroke: #ffc107; stroke-width: 2; }
  .process { fill: #d4edda; stroke: #28a745; stroke-width: 2; }
  .start-end { fill: #cce5ff; stroke: #0066cc; stroke-width: 3; rx: 25; }
  .action { fill: #f8d7da; stroke: #dc3545; stroke-width: 2; }
  .data { fill: #e7f3ff; stroke: #007bff; stroke-width: 2; }
  .warning { fill: #fff3cd; stroke: #ff8800; stroke-width: 2; }
  .arrow { stroke: #333; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
  .arrow-yes { stroke: #28a745; stroke-width: 2.5; fill: none; marker-end: url(#arrowhead-yes); }
  .arrow-no { stroke: #dc3545; stroke-width: 2.5; fill: none; marker-end: url(#arrowhead-no); }
  .label { font-family: Arial, sans-serif; font-size: 14px; font-weight: bold; fill: #28a745; }
  .label-no { font-family: Arial, sans-serif; font-size: 14px; font-weight: bold; fill: #dc3545; }
  .note { font-family: Arial, sans-serif; font-size: 12px; fill: #666; font-style: italic; }
</style>
  </defs>
  <rect width="1600" height="2720" fill="#ffffff" y="-1"/>
  <text class="title" x="800" y="40" text-anchor="middle">Algorytm 5A: Rotacja UkÅ‚adÃ³w Pracy CiÄ…gÃ³w</text>
  <text class="subtitle" x="800" y="65" text-anchor="middle">Podstawowy â†” Ograniczony (C1 â†” C2) z koordynacjÄ… 5B</text>
  
  <!-- START -->
  <rect class="start-end" x="650" y="90" width="300" height="60"/>
  <text class="box-text" x="800" y="125">START - GÅ‚Ã³wna pÄ™tla</text>
  <text class="box-text-small" x="800" y="142">(co CYKL_PÄ˜TLI, domyÅ›lnie 60s)</text>
  <line class="arrow" x1="800" y1="150" x2="800" y2="180"/>
  
  <!-- Zmienne globalne -->
  <rect class="warning" x="600" y="190" width="400" height="90"/>
  <text class="box-text-small" x="800" y="210">âš™ï¸ Zmienne globalne (koordynacja z 5B):</text>
  <text class="box-text-small" x="800" y="227">aktualny_ukÅ‚ad, zmiana_ukÅ‚adu_w_toku,</text>
  <text class="box-text-small" x="800" y="244">czas_ostatniej_zmiany_ukÅ‚adu,</text>
  <text class="box-text-small" x="800" y="261">rotacja_nagrzewnic_w_toku</text>
  <line class="arrow" x1="800" y1="280" x2="800" y2="320"/>
  
  <!-- KROK 1 -->
  <text class="box-label" x="50" y="375">KROK 1</text>
  <polygon class="decision" points="800,330 1050,400 800,470 550,400"/>
  <text class="box-text" x="800" y="390">Czy warunki rotacji</text>
  <text class="box-text" x="800" y="410">speÅ‚nione?</text>
  <text class="box-text-small" x="800" y="430">(S1-S4, C2 sprawny, AUTO)</text>
  <line class="arrow-yes" x1="800" y1="470" x2="800" y2="530"/>
  <text class="label" x="820" y="500">TAK</text>
  <line class="arrow-no" x1="550" y1="400" x2="350" y2="400"/>
  <text class="label-no" x="420" y="390">NIE</text>
  <rect class="action" x="200" y="370" width="150" height="60"/>
  <text class="box-text-small" x="275" y="395">JeÅ›li ukÅ‚ad</text>
  <text class="box-text-small" x="275" y="412">= Ograniczony:</text>
  <text class="box-text-small" x="275" y="429">â†’ Podstawowy</text>
  <line class="arrow-no" x1="199.53" y1="400" x2="146.93" y2="400"/>
  <line class="arrow-no" x1="149" y1="400" x2="149" y2="2490"/>
  <line class="arrow-no" x1="149" y1="2490" x2="650" y2="2490"/>
  
  <!-- KROK 2 -->
  <text class="box-label" x="50" y="555">KROK 2</text>
  <polygon class="decision" points="800,530 1020,590 800,650 580,590"/>
  <text class="box-text" x="800" y="580">UpÅ‚ynÄ…Å‚</text>
  <text class="box-text" x="800" y="600">OKRES_ROTACJI?</text>
  <line class="arrow-yes" x1="800" y1="650" x2="800" y2="710"/>
  <text class="label" x="820" y="680">TAK</text>
  <line class="arrow-no" x1="1020" y1="590" x2="1486.82" y2="590"/>
  <text class="label-no" x="1200" y="580">NIE</text>
  <line class="arrow-no" x1="1486.18" y1="590" x2="1486.18" y2="2490"/>
  <line class="arrow-no" x1="1486.18" y1="2490" x2="950" y2="2490"/>
  
  <!-- KROK 3 -->
  <text class="box-label" x="50" y="735">KROK 3</text>
  <rect class="process" x="650" y="710" width="300" height="80"/>
  <text class="box-text" x="800" y="740">OkreÅ›l nowy ukÅ‚ad:</text>
  <text class="box-text-small" x="800" y="760">JeÅ›li Podstawowy â†’ Ograniczony</text>
  <text class="box-text-small" x="800" y="780">JeÅ›li Ograniczony â†’ Podstawowy</text>
  <line class="arrow" x1="800" y1="790" x2="800" y2="840"/>
  
  <!-- KROK 4 - SprawdÅº blokadÄ™ 5B (NOWY!) -->
  <text class="box-label" x="50" y="885">KROK 4</text>
  <polygon class="decision" points="800,850 1100,920 800,990 500,920"/>
  <text class="box-text" x="800" y="905">Czy 5B wykonuje</text>
  <text class="box-text" x="800" y="925">rotacjÄ™ nagrzewnic?</text>
  <text class="box-text-small" x="800" y="945">(rotacja_nagrzewnic_w_toku)</text>
  
  <!-- TAK - odrocz zmianÄ™ -->
  <line class="arrow-yes" x1="1100" y1="920" x2="1300" y2="920"/>
  <text class="label" x="1180" y="910">TAK</text>
  <rect class="warning" x="1300" y="890" width="180" height="60"/>
  <text class="box-text-small" x="1390" y="915">Odrocz zmianÄ™</text>
  <text class="box-text-small" x="1390" y="932">(5B rotuje)</text>
  <line class="arrow" x1="1390" y1="950" x2="1390" y2="2490"/>
  <line class="arrow" x1="1390" y1="2490" x2="950" y2="2490"/>
  
  <!-- NIE - kontynuuj sprawdzanie -->
  <line class="arrow-no" x1="800" y1="990" x2="800" y2="1050"/>
  <text class="label-no" x="820" y="1020">NIE</text>
  
  <!-- SprawdÅº rotacja moÅ¼liwa i wymagana -->
  <polygon class="decision" points="800,1060 1000,1110 800,1160 600,1110"/>
  <text class="box-text" x="800" y="1100">Rotacja moÅ¼liwa</text>
  <text class="box-text" x="800" y="1120">i wymagana?</text>
  <line class="arrow-no" x1="1000" y1="1110" x2="1320" y2="1110"/>
  <text class="label-no" x="1150" y="1100">NIE</text>
  <line class="arrow-no" x1="1320" y1="1110" x2="1320" y2="2490"/>
  <line class="arrow-no" x1="1320" y1="2490" x2="950" y2="2490"/>
  <line class="arrow-yes" x1="800" y1="1160" x2="800" y2="1220"/>
  <text class="label" x="820" y="1190">TAK</text>
  
  <!-- Ustaw blokadÄ™ (NOWY!) -->
  <rect class="warning" x="650" y="1230" width="300" height="50"/>
  <text class="box-text-small" x="800" y="1250">ğŸ”’ Ustaw blokadÄ™:</text>
  <text class="box-text-small" x="800" y="1267">zmiana_ukÅ‚adu_w_toku = PRAWDA</text>
  <line class="arrow" x1="800" y1="1280" x2="800" y2="1320"/>
  
  <!-- Rejestruj rozpoczÄ™cie -->
  <rect class="data" x="650" y="1330" width="300" height="50"/>
  <text class="box-text-small" x="800" y="1355">ğŸ“ Rejestruj zdarzenie:</text>
  <text class="box-text-small" x="800" y="1372">"RozpoczÄ™cie zmiany ukÅ‚adu"</text>
  <line class="arrow" x1="800" y1="1380" x2="800" y2="1420"/>
  
  <!-- Wykonaj zmianÄ™ ukÅ‚adu -->
  <rect class="action" x="600" y="1430" width="400" height="60"/>
  <text class="box-text" x="800" y="1455">âš™ï¸ Wykonaj_ZmianÄ™_UkÅ‚adu()</text>
  <text class="box-text-small" x="800" y="1475">(szczegÃ³Å‚y poniÅ¼ej)</text>
  <line class="arrow" x1="800" y1="1490" x2="800" y2="1530"/>
  <line class="arrow" x1="800" y1="1530" x2="400" y2="1590"/>
  <line class="arrow" x1="800" y1="1530" x2="1200" y2="1590"/>
  
  <!-- Podstawowy â†’ Ograniczony -->
  <rect class="action" x="200" y="1600" width="400" height="40"/>
  <text class="box-text" x="400" y="1625">ğŸ”„ Podstawowy â†’ Ograniczony</text>
  <line class="arrow" x1="400" y1="1640" x2="400" y2="1660"/>
  <rect class="process" x="220" y="1670" width="360" height="30"/>
  <text class="box-text-small" x="400" y="1690">1. Zatrzymaj ciÄ…g 1 (N1-N4, W1)</text>
  <line class="arrow" x1="400" y1="1700" x2="400" y2="1710"/>
  <rect class="process" x="220" y="1720" width="360" height="30"/>
  <text class="box-text-small" x="400" y="1740">2. OtwÃ³rz spinÄ™ ciÄ…gÃ³w</text>
  <line class="arrow" x1="400" y1="1750" x2="400" y2="1760"/>
  <rect class="process" x="220" y="1770" width="360" height="30"/>
  <text class="box-text-small" x="400" y="1790">3. Zamknij przepustnice C1</text>
  <line class="arrow" x1="400" y1="1800" x2="400" y2="1810"/>
  <rect class="process" x="220" y="1820" width="360" height="30"/>
  <text class="box-text-small" x="400" y="1840">4. Uruchom ciÄ…g 2 (N5-N8, W2)</text>
  <line class="arrow" x1="400" y1="1850" x2="400" y2="1860"/>
  <rect class="process" x="220" y="1870" width="360" height="30"/>
  <text class="box-text-small" x="400" y="1890">5. Aktywuj PID dla W2 (Ts=2Â°C)</text>
  
  <!-- Ograniczony â†’ Podstawowy -->
  <rect class="action" x="1000" y="1600" width="400" height="40"/>
  <text class="box-text" x="1200" y="1625">ğŸ”„ Ograniczony â†’ Podstawowy</text>
  <line class="arrow" x1="1200" y1="1640" x2="1200" y2="1660"/>
  <rect class="process" x="1020" y="1670" width="360" height="30"/>
  <text class="box-text-small" x="1200" y="1690">1. Zatrzymaj ciÄ…g 2 (N5-N8, W2)</text>
  <line class="arrow" x1="1200" y1="1700" x2="1200" y2="1710"/>
  <rect class="process" x="1020" y="1720" width="360" height="30"/>
  <text class="box-text-small" x="1200" y="1740">2. Zamknij spinÄ™ ciÄ…gÃ³w</text>
  <line class="arrow" x1="1200" y1="1750" x2="1200" y2="1760"/>
  <rect class="process" x="1020" y="1770" width="360" height="30"/>
  <text class="box-text-small" x="1200" y="1790">3. OtwÃ³rz przepustnice C1</text>
  <line class="arrow" x1="1200" y1="1800" x2="1200" y2="1810"/>
  <rect class="process" x="1020" y="1820" width="360" height="30"/>
  <text class="box-text-small" x="1200" y="1840">4. Uruchom ciÄ…g 1 (N1-N4, W1)</text>
  <line class="arrow" x1="1200" y1="1850" x2="1200" y2="1860"/>
  <rect class="process" x="1020" y="1870" width="360" height="30"/>
  <text class="box-text-small" x="1200" y="1890">5. Aktywuj PID dla W1 (Ts=2Â°C)</text>
  
  <!-- Merge -->
  <line class="arrow" x1="400" y1="1900" x2="400" y2="1964.83"/>
  <line class="arrow" x1="396.753" y1="1964.99" x2="796.753" y2="1964.99"/>
  <line class="arrow" x1="1200" y1="1900" x2="1200" y2="1968.13"/>
  <line class="arrow" x1="1201.9" y1="1965.85" x2="801.904" y2="1965.85"/>
  <line class="arrow" x1="800" y1="1963.34" x2="800" y2="2010"/>
  
  <!-- Aktualizuj zmienne (ROZSZERZONY!) -->
  <rect class="data" x="600" y="2020" width="400" height="90"/>
  <text class="box-text-small" x="800" y="2045">Aktualizuj zmienne:</text>
  <text class="box-text-small" x="800" y="2062">aktualny_ukÅ‚ad = nowy_ukÅ‚ad</text>
  <text class="box-text-small" x="800" y="2079">czas_ostatniej_zmiany = teraz</text>
  <text class="box-text-small" x="800" y="2096">czas_ostatniej_zmiany_ukÅ‚adu = teraz (dla 5B)</text>
  <line class="arrow" x1="800" y1="2110" x2="800" y2="2160"/>
  
  <!-- Rejestruj zakoÅ„czenie -->
  <rect class="data" x="650" y="2170" width="300" height="50"/>
  <text class="box-text-small" x="800" y="2195">ğŸ“ Rejestruj zdarzenie:</text>
  <text class="box-text-small" x="800" y="2212">"ZakoÅ„czono zmianÄ™ ukÅ‚adu"</text>
  <line class="arrow" x1="800" y1="2220" x2="800" y2="2260"/>
  
  <!-- Zwolnij blokadÄ™ (NOWY!) -->
  <rect class="warning" x="650" y="2270" width="300" height="50"/>
  <text class="box-text-small" x="800" y="2290">ğŸ”“ Zwolnij blokadÄ™:</text>
  <text class="box-text-small" x="800" y="2307">zmiana_ukÅ‚adu_w_toku = FAÅSZ</text>
  <line class="arrow" x1="800" y1="2320" x2="800" y2="2360"/>
  
  <!-- KROK 5 -->
  <text class="box-label" x="50" y="2385">KROK 5</text>
  <polygon class="decision" points="800,2370 1020,2420 800,2470 580,2420"/>
  <text class="box-text" x="800" y="2410">aktualny_ukÅ‚ad</text>
  <text class="box-text" x="800" y="2430">= Podstawowy?</text>
  <line class="arrow-yes" x1="580" y1="2420" x2="450" y2="2420"/>
  <text class="label" x="480" y="2410">TAK</text>
  <rect class="data" x="250" y="2390" width="200" height="60"/>
  <text class="box-text-small" x="350" y="2415">czas_pracy_</text>
  <text class="box-text-small" x="350" y="2432">ukÅ‚adu_podstawowego</text>
  <text class="box-text-small" x="350" y="2449">+= 1</text>
  <line class="arrow" x1="350" y1="2450" x2="350" y2="2490"/>
  <line class="arrow" x1="350" y1="2490" x2="650" y2="2490"/>
  <line class="arrow-no" x1="1020" y1="2420" x2="1150" y2="2420"/>
  <text class="label-no" x="1050" y="2410">NIE</text>
  <rect class="data" x="1150" y="2390" width="200" height="60"/>
  <text class="box-text-small" x="1250" y="2415">czas_pracy_</text>
  <text class="box-text-small" x="1250" y="2432">ukÅ‚adu_ograniczonego</text>
  <text class="box-text-small" x="1250" y="2449">+= 1</text>
  <line class="arrow" x1="1250" y1="2450" x2="1250" y2="2490"/>
  <line class="arrow" x1="1250" y1="2490" x2="950" y2="2490"/>
  
  <!-- Czekaj -->
  <rect class="process" x="650" y="2465" width="300" height="50"/>
  <text class="box-text" x="800" y="2495">Czekaj CYKL_PÄ˜TLI</text>
  <line class="arrow" x1="650" y1="2490" x2="100" y2="2490"/>
  <line class="arrow" x1="100" y1="2490" x2="100" y2="120"/>
  <line class="arrow" x1="100" y1="120" x2="650" y2="120"/>
  
  <!-- Legend -->
  <rect x="50" y="2550" width="1500" height="70" fill="#f8f9fa" stroke="#dee2e6" stroke-width="1"/>
  <text class="note" x="70" y="2570">Legenda:</text>
  <rect class="decision" x="170" y="2555" width="60" height="30"/>
  <text class="note" x="240" y="2573">Decyzja</text>
  <rect class="process" x="320" y="2555" width="60" height="30"/>
  <text class="note" x="390" y="2573">Proces</text>
  <rect class="action" x="470" y="2555" width="60" height="30"/>
  <text class="note" x="540" y="2573">Akcja zmiany</text>
  <rect class="data" x="630" y="2555" width="60" height="30"/>
  <text class="note" x="700" y="2573">Dane/Log</text>
  <rect class="warning" x="780" y="2555" width="60" height="30"/>
  <text class="note" x="850" y="2573">Blokada/Sync</text>
  
  <text class="note" x="70" y="2600">âš™ï¸ OKRES_ROTACJI_UKÅADÃ“W = parametr technologa (np. 168h = 7 dni)</text>
  <text class="note" x="70" y="2615">â±ï¸ CYKL_PÄ˜TLI_ALGORYTMÃ“W = czÄ™stoÅ›Ä‡ sprawdzania (domyÅ›lnie 60s = 1 min, zakres: 10s-600s)</text>
  <text class="note" x="70" y="2630">ğŸ”’ Koordynacja z Algorytmem 5B: blokady zapobiegajÄ… jednoczesnej rotacji ukÅ‚adÃ³w i nagrzewnic</text>
</svg>
