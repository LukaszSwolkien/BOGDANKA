<?xml version="1.0" encoding="utf-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 2800" width="1400px" height="2800px">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#333"/>
    </marker>
    <marker id="arrowhead-no" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#dc3545"/>
    </marker>
    <marker id="arrowhead-yes" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#28a745"/>
    </marker>
    <style>
  .title { font-family: Arial, sans-serif; font-size: 28px; font-weight: bold; fill: #1a1a1a; }
  .subtitle { font-family: Arial, sans-serif; font-size: 18px; fill: #555; }
  .box-text { font-family: Arial, sans-serif; font-size: 15px; fill: #1a1a1a; text-anchor: middle; }
  .box-text-small { font-family: Arial, sans-serif; font-size: 13px; fill: #1a1a1a; text-anchor: middle; }
  .box-label { font-family: Arial, sans-serif; font-size: 14px; font-weight: bold; fill: #1a1a1a; }
  .decision { fill: #fff3cd; stroke: #ffc107; stroke-width: 2; }
  .process { fill: #d4edda; stroke: #28a745; stroke-width: 2; }
  .start-end { fill: #cce5ff; stroke: #0066cc; stroke-width: 3; rx: 25; }
  .action { fill: #f8d7da; stroke: #dc3545; stroke-width: 2; }
  .data { fill: #e7f3ff; stroke: #007bff; stroke-width: 2; }
  .warning { fill: #fff3cd; stroke: #ff8800; stroke-width: 2; }
  .arrow { stroke: #333; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
  .arrow-yes { stroke: #28a745; stroke-width: 2.5; fill: none; marker-end: url(#arrowhead-yes); }
  .arrow-no { stroke: #dc3545; stroke-width: 2.5; fill: none; marker-end: url(#arrowhead-no); }
  .label { font-family: Arial, sans-serif; font-size: 14px; font-weight: bold; fill: #28a745; }
  .label-no { font-family: Arial, sans-serif; font-size: 14px; font-weight: bold; fill: #dc3545; }
  .note { font-family: Arial, sans-serif; font-size: 12px; fill: #666; font-style: italic; }
  .loop { font-family: Arial, sans-serif; font-size: 13px; fill: #0066cc; font-style: italic; }
</style>
  </defs>
  <rect width="1400" height="2800" fill="#ffffff"/>
  <text class="title" x="700" y="40" text-anchor="middle" style="white-space: pre;">Algorytm RN: Rotacja Nagrzewnic w Obrƒôbie CiƒÖgu</text>
  <text class="subtitle" x="700" y="65" text-anchor="middle" style="white-space: pre;">Wyr√≥wnanie Czasu Pracy N1-N8 (v2.2 - koordynacja RC-RN dwukierunkowa)</text>
  <rect class="start-end" x="550" y="90" width="300" height="60"/>
  <text class="box-text" x="700" y="115" style="white-space: pre;">START - G≈Ç√≥wna pƒôtla</text>
  <text class="box-text-small" x="700" y="135" style="white-space: pre;">(co CYKL_PƒòTLI_ALGORYTM√ìW)</text>
  <path d="M 700 150 L 700 200" class="arrow"/>
  <rect class="process" x="500" y="200" width="400" height="80"/>
  <text class="box-text" x="700" y="225" style="white-space: pre;">KROK 0: Aktualizuj liczniki</text>
  <text class="box-text-small" x="700" y="245" style="white-space: pre;">DLA KA≈ªDEJ aktywnej nagrzewnicy:</text>
  <text class="box-text-small" x="700" y="265" style="white-space: pre;">czas_pracy[N] += 1 (lub czas_postoju[N])</text>
  <path d="M 700 280 L 700 340" class="arrow"/>
  <path d="M 700 340 L 830 400 L 700 460 L 570 400 Z" class="decision"/>
  <text class="box-text" x="700" y="390" style="white-space: pre;">KROK 1:</text>
  <text class="box-text-small" x="700" y="410" style="white-space: pre;">Tryb AUTO?</text>
  <path d="M 577 400 L 100 400 L 100 2551 L 551 2551" class="arrow-no"/>
  <text class="label-no" x="450" y="390" style="white-space: pre;">NIE</text>
  <text class="note" x="250" y="420" style="white-space: pre;">Tryb MANUAL - algorytm nieaktywny</text>
  <path d="M 700 460 L 700 520" class="arrow-yes"/>
  <text class="label" x="720" y="480" style="white-space: pre;">TAK</text>
  <rect class="process" x="586.893" y="520" width="223.102" height="60" style=""/>
  <text class="box-text" x="700" y="545" style="white-space: pre;">KROK 2: DLA KA≈ªDEGO ciƒÖgu</text>
  <text class="box-text-small" x="700" y="565" style="white-space: pre;">w [CIƒÑG1, CIƒÑG2]</text>
  <path d="M 700 580 L 700 640" class="arrow"/>
  <path d="M 700 640 L 900 720 L 700 800 L 500 720 Z" class="decision"/>
  <text class="box-text" x="700" y="700" style="white-space: pre;">KROK 3: CiƒÖg aktywny</text>
  <text class="box-text" x="700" y="720" style="white-space: pre;">w uk≈Çadzie/scenariuszu?</text>
  <text class="box-text-small" x="700" y="740" style="white-space: pre;">(S1-S4: C1/C2, S5-S8: C2)</text>
  <path d="M 503 720 L 200 720 L 200 2535 L 551 2535" class="arrow-no"/>
  <text class="label-no" x="300" y="710" style="white-space: pre;">NIE</text>
  <text class="note" x="250" y="740" style="white-space: pre;">CiƒÖg wy≈ÇƒÖczony</text>
  <path d="M 700 800 L 700 860" class="arrow-yes"/>
  <text class="label" x="720" y="820" style="white-space: pre;">TAK</text>
  <path d="M 700 890 L 914 955 L 700 1020 L 486 955 Z" class="decision"/>
  <text class="box-text" x="700" y="925" style="white-space: pre;">KROK 4:</text>
  <text class="box-text-small" x="700" y="945" style="white-space: pre;">Warunki rotacji spe≈Çnione?</text>
  <text class="box-text-small" x="700" y="965" style="white-space: pre;">(RC nie zmienia, 50min OD+DO RC,</text>
  <text class="box-text-small" x="700" y="985" style="white-space: pre;">15min spacing, okres OK, stabilno≈õƒá, rezerwowe)</text>
  <path d="M 482 955 L 300 955 L 300 2513 L 550 2513" class="arrow-no"/>
  <text class="label-no" x="350" y="940" style="white-space: pre;">NIE</text>
  <path d="M 700 1040 L 700 1100" class="arrow-yes"/>
  <text class="label" x="720" y="1060" style="white-space: pre;">TAK</text>
  <path d="M 700 1100 L 870 1170 L 700 1240 L 530 1170 Z" class="decision"/>
  <text class="box-text" x="700" y="1155" style="white-space: pre;">KROK 5:</text>
  <text class="box-text-small" x="700" y="1175" style="white-space: pre;">delta_czasu ‚â•</text>
  <text class="box-text-small" x="700" y="1195" style="white-space: pre;">MIN_DELTA_CZASU?</text>
  <path d="M 530 1170 L 420 1170 L 420 2494 L 550 2494" class="arrow-no"/>
  <text class="label-no" x="455" y="1149" style="white-space: pre;">NIE</text>
  <text class="note" x="434" y="1195" style="white-space: pre;">R√≥≈ºnica czasu zbyt ma≈Ça</text>
  <path d="M 700 1240 L 700 1300" class="arrow-yes"/>
  <text class="label" x="720" y="1260" style="white-space: pre;">TAK</text>
  <rect class="warning" x="550" y="1300" width="300" height="50"/>
  <text class="box-text-small" x="700" y="1320" style="white-space: pre;">üîí Ustaw blokadƒô:</text>
  <text class="box-text-small" x="700" y="1337" style="white-space: pre;">rotacja_nagrzewnic_w_toku = PRAWDA</text>
  <path d="M 700 1350 L 700 1400" class="arrow"/>
  <rect class="data" x="550" y="1400" width="300" height="50"/>
  <text class="box-text-small" x="700" y="1425" style="white-space: pre;">Rejestruj zdarzenie:</text>
  <text class="box-text-small" x="700" y="1442" style="white-space: pre;">"Rotacja N_stara ‚Üí N_nowa"</text>
  <path d="M 700 1450 L 700 1510" class="arrow"/>
  <rect class="action" x="500" y="1510" width="400" height="80"/>
  <text class="box-text" x="700" y="1535" style="white-space: pre;">KROK 6: Wykonaj rotacjƒô</text>
  <text class="box-text-small" x="700" y="1555" style="white-space: pre;">Wykonaj_Rotacjƒô_Nagrzewnicy()</text>
  <text class="box-text-small" x="700" y="1575" style="white-space: pre;">(Najpierw za≈ÇƒÖcz N_nowa, potem wy≈ÇƒÖcz N_stara)</text>
  <path d="M 700 1590 L 700 1660" class="arrow"/>
  <path d="M 700 1660 L 890 1730 L 700 1800 L 510 1730 Z" class="decision"/>
  <text class="box-text" x="700" y="1715" style="white-space: pre;">KROK 6A:</text>
  <text class="box-text-small" x="700" y="1735" style="white-space: pre;">Sukces rotacji?</text>
  <path d="M 1092.83 1730.44 L 892.571 1730.44" class="arrow-no" style="transform-origin: 992.7px 1730.44px;" transform="matrix(-0.99999709, -0.00001207, -0.00000291, -1.00000581, 0.00892914, 0.03571657)"/>
  <text class="label-no" x="907.24" y="1723.83" style="white-space: pre; font-size: 14px;">NIE</text>
  <g transform="matrix(1, 0, 0, 1, 996.275390625, 0.2612769901752472)">
    <rect class="action" x="100" y="1660" width="220" height="140"/>
    <text class="box-text-small" x="210" y="1685" style="font-size: 14px; white-space: pre;">üö® ALARM AWARYJNY</text>
    <text class="box-text-small" x="210" y="1705" style="font-size: 12px; white-space: pre;">B≈ÇƒÖd rotacji:</text>
    <text class="box-text-small" x="210" y="1722" style="font-size: 12px; white-space: pre;">‚Ä¢ N_nowa nie gotowa LUB</text>
    <text class="box-text-small" x="210" y="1739" style="font-size: 12px; white-space: pre;">‚Ä¢ Temp. poza zakresem</text>
    <text class="box-text-small" x="210" y="1760" style="font-size: 12px; white-space: pre;">Rollback:</text>
    <text class="box-text-small" x="210" y="1777" style="font-size: 12px; white-space: pre;">N_stara pozostaje aktywna</text>
    <text class="box-text-small" x="210" y="1794" style="font-size: 12px; white-space: pre;">Rejestruj alarm</text>
  </g>
  <path d="M 847.252 2069.49 L 847.252 1799.23 L 1199.6 1799.23" class="arrow" style="transform-origin: 1023.43px 1934.36px;" transform="matrix(-1, 0, 0, -1, -0.00012207, 0.00610352)"/>
  <path d="M 700 1800 L 700 1835.61" class="arrow-yes" style=""/>
  <text class="label" x="720" y="1820" style="white-space: pre;">TAK</text>
  <rect class="data" x="520.57" y="1838.78" width="360" height="90"/>
  <text class="box-text-small" x="700" y="1859" style="white-space: pre; font-size: 13px;">KROK 7: Aktualizuj stany:</text>
  <text class="box-text-small" x="700" y="1879" style="white-space: pre; font-size: 13px;">‚Ä¢ nagrzewnice_aktywne[ciƒÖg]</text>
  <text class="box-text-small" x="700" y="1899" style="white-space: pre; font-size: 13px;">‚Ä¢ czas_ostatniej_rotacji[ciƒÖg]</text>
  <text class="box-text-small" x="700" y="1919" style="white-space: pre; font-size: 13px;">‚Ä¢ czas_ostatniej_rotacji_globalny</text>
  <path d="M 702.339 2008.57 L 702.339 2044.34" class="arrow" style=""/>
  <g transform="matrix(1, 0, 0, 1, 1.8227169513702393, -44.08378601074219)">
    <rect class="data" x="550" y="2000" width="300" height="50"/>
    <text class="box-text-small" x="700" y="2025" style="white-space: pre;">Rejestruj zdarzenie:</text>
    <text class="box-text-small" x="700" y="2042" style="white-space: pre;">"Rotacja zako≈Ñczona pomy≈õlnie"</text>
  </g>
  <path d="M 700 2090.06 L 700 2128" class="arrow" style=""/>
  <g transform="matrix(1, 0, 0, 1, 1.68072509765625, 142.18096923828125)">
    <rect class="warning" x="550" y="1900" width="300" height="50"/>
    <text class="box-text-small" x="700" y="1920" style="white-space: pre;">üîì Zwolnij blokadƒô:</text>
    <text class="box-text-small" x="700" y="1937" style="white-space: pre;">rotacja_nagrzewnic_w_toku = FA≈ÅSZ</text>
  </g>
  <path d="M 703.007 1928.05 L 703.007 1955.81" class="arrow" style=""/>
  <path d="M 700 2128 L 870 2198 L 700 2268 L 530 2198 L 700 2128 Z" class="decision"/>
  <text class="box-text" x="700" y="2170" style="white-space: pre;">KROK 8:</text>
  <text class="box-text" x="700" y="2190" style="white-space: pre;">Wiƒôcej ciƒÖg√≥w?</text>
  <path d="M 869.647 2201.38 L 1334.45 2201.38 L 1334.45 548 L 810.408 548" class="arrow-yes" style=""/>
  <text class="label" x="906.483" y="2186.13" style="white-space: pre; font-size: 14px;">TAK</text>
  <path d="M 700 2264.66 L 700 2469.35" class="arrow-no" style=""/>
  <text class="label-no" x="720" y="2300" style="white-space: pre;">NIE</text>
  <g transform="matrix(1, 0, 0, 1, 2.6767039299012367, 154.5138168334961)">
    <rect class="process" x="550" y="2320" width="300" height="80"/>
    <text class="box-text" x="700" y="2367" style="white-space: pre;">Czekaj CYKL_PƒòTLI_ALGORYTM√ìW</text>
  </g>
  <path d="M 850 2513.82 L 1384.96 2513.82 L 1384.96 120 L 850 120" class="arrow" style=""/>
  <g transform="matrix(1, 0, 0, 1, 918.0480346679688, 508.87628173828125)">
    <rect x="20" y="100" width="363.952" height="720" fill="#f9f9f9" stroke="#999" stroke-width="1"/>
    <text class="box-label" style="font-size: 17px; white-space: pre;" x="47" y="124">PARAMETRY:</text>
    <text class="box-text-small" style="font-size: 16px; white-space: pre;" x="187" y="143">‚Ä¢ CYKL_PƒòTLI_ALGORYTM√ìW = 60s</text>
    <text class="box-text-small" style="font-size: 16px; white-space: pre;" x="181" y="162">‚Ä¢ OKRES_ROTACJI_NAGRZEWNIC</text>
    <text class="box-text-small" style="font-size: 16px; white-space: pre;" x="132" y="180">‚Ä¢ MIN_DELTA_CZASU</text>
    <text class="box-text-small" style="font-size: 16px; white-space: pre;" x="196" y="200">‚Ä¢ CZAS_STABILIZACJI_NAGRZEWNICY</text>
    <text class="box-text-small" style="font-size: 16px; white-space: pre;" x="203" y="220">‚Ä¢ ODSTƒòP_KOORDYNACJI_RC_RN = 3000s</text>
    <text class="box-text-small" style="font-size: 16px; white-space: pre;" x="192" y="240">‚Ä¢ ODSTƒòP_MIƒòDZY_ROTACJAMI = 900s</text>
    <text class="box-label" style="font-size: 17px; white-space: pre;" x="49" y="267">ZMIENNE GLOBALNE:</text>
    <text class="box-text-small" style="font-size: 15px; white-space: pre;" x="99" y="290">‚Ä¢ aktualny_uk≈Çad</text>
    <text class="box-text-small" style="font-size: 15px; white-space: pre;" x="128" y="309">‚Ä¢ zmiana_uk≈Çadu_w_toku</text>
    <text class="box-text-small" style="font-size: 15px; white-space: pre;" x="150" y="327">‚Ä¢ czas_ostatniej_zmiany_uk≈Çadu</text>
    <text class="box-text-small" style="font-size: 15px; white-space: pre;" x="141" y="345">‚Ä¢ rotacja_nagrzewnic_w_toku</text>
    <text class="box-text-small" style="font-size: 15px; white-space: pre;" x="152" y="363">‚Ä¢ czas_ostatniej_rotacji_globalny</text>
    <text class="box-label" style="font-size: 17px; white-space: pre;" x="50" y="392">ZMIENNE LOKALNE:</text>
    <text class="box-text-small" style="font-size: 15px; white-space: pre;" x="119" y="413">‚Ä¢ czas_pracy[N1..N8]</text>
    <text class="box-text-small" style="font-size: 15px; white-space: pre;" x="124" y="432">‚Ä¢ czas_postoju[N1..N8]</text>
    <text class="box-text-small" style="font-size: 15px; white-space: pre;" x="154" y="453">‚Ä¢ timestamp_zalaczenia[N1..N8]</text>
    <text class="box-text-small" style="font-size: 15px; white-space: pre;" x="176" y="475">‚Ä¢ czas_ostatniej_rotacji[CIƒÑG1,CIƒÑG2]</text>
    <text class="box-text-small" style="font-size: 15px; white-space: pre;" x="149" y="494">‚Ä¢ nagrzewnice_aktywne[CIƒÑG]</text>
    <text class="box-text-small" style="font-size: 15px; white-space: pre;" x="108" y="515">‚Ä¢ last_update_time</text>
    <text class="box-text-small" style="font-size: 15px; white-space: pre;" x="125" y="534">‚Ä¢ poprzedni_scenariusz</text>
    <text class="box-text-small" style="font-size: 15px; white-space: pre;" x="107" y="554">‚Ä¢ poprzedni_uk≈Çad</text>
    <text class="box-label" style="font-size: 17px; white-space: pre;" x="38" y="594">üîí KOORDYNACJA Z RC:</text>
    <text class="note" style="font-size: 14px; white-space: pre;" x="47" y="613">‚Ä¢ Blokady zapobiegajƒÖ jednoczesnej</text>
    <text class="note" style="font-size: 14px; white-space: pre;" x="57" y="628">rotacji uk≈Çad√≥w (RC) i nagrzewnic (RN)</text>
    <text class="note" style="font-size: 14px; white-space: pre;" x="47" y="648">‚Ä¢ KROK 4: RN sprawdza</text>
    <text class="note" style="font-size: 14px; white-space: pre;" x="57" y="663">- zmiana_uk≈Çadu_w_toku</text>
    <text class="note" style="font-size: 14px; white-space: pre;" x="57" y="678">- 50min PO rotacji RC</text>
    <text class="note" style="font-size: 14px; white-space: pre;" x="57" y="693">- 50min PRZED rotacjƒÖ RC</text>
    <text class="note" style="font-size: 14px; white-space: pre;" x="47" y="713">‚Ä¢ RN ustawia/zwalnia</text>
    <text class="note" style="font-size: 14px; white-space: pre;" x="57" y="728">rotacja_nagrzewnic_w_toku</text>
    <text class="box-label" style="font-size: 17px; white-space: pre;" x="38" y="758">üö® OBS≈ÅUGA AWARII:</text>
    <text class="note" style="font-size: 14px; white-space: pre;" x="47" y="777">‚Ä¢ KROK 6A sprawdza sukces rotacji</text>
    <text class="note" style="font-size: 14px; white-space: pre;" x="47" y="792">‚Ä¢ B≈ÇƒÖd ‚Üí rollback (N_stara aktywna)</text>
    <text class="note" style="font-size: 14px; white-space: pre;" x="47" y="807">‚Ä¢ System kontynuuje bez rotacji</text>
  </g>
  <rect x="50" y="2600" width="1300" height="180" fill="#f8f9fa" stroke="#dee2e6" stroke-width="1"/>
  <text class="note" x="70" y="2625" style="white-space: pre;">LEGENDA:</text>
  <rect class="start-end" x="170" y="2610" width="100" height="35"/>
  <text class="box-text-small" x="220" y="2632" style="white-space: pre;">START/KONIEC</text>
  <rect class="decision" x="290" y="2610" width="60" height="35"/>
  <text class="box-text-small" x="320" y="2632" style="white-space: pre;">Decyzja</text>
  <rect class="process" x="370" y="2610" width="60" height="35"/>
  <text class="box-text-small" x="400" y="2632" style="white-space: pre;">Proces</text>
  <rect class="action" x="450" y="2610" width="80" height="35"/>
  <text class="box-text-small" x="490" y="2632" style="white-space: pre;">Akcja rotacji</text>
  <rect class="data" x="550" y="2610" width="60" height="35"/>
  <text class="box-text-small" x="580" y="2632" style="white-space: pre;">Dane/Log</text>
  <rect class="warning" x="630" y="2610" width="80" height="35"/>
  <text class="box-text-small" x="670" y="2632" style="white-space: pre;">Blokada/Sync</text>
  <text class="note" x="70" y="2665" style="white-space: pre;">UWAGA: Algorytm RN wsp√≥≈Çpracuje z RC poprzez blokady (zmiana_uk≈Çadu_w_toku, rotacja_nagrzewnic_w_toku).</text>
  <text class="note" x="70" y="2685" style="white-space: pre;">KRYTYCZNE: RN ustala blokadƒô PRZED rotacjƒÖ i zwalnia PO zako≈Ñczeniu - zapobiega konfliktom z RC.</text>
  <text class="note" x="70" y="2715" style="font-weight: bold; white-space: pre;">ZMIANY v2.2: Dwukierunkowa koordynacja RC-RN (29 Listopad 2025):</text>
  <text class="note" x="90" y="2735" style="white-space: pre;">‚Ä¢ RN sprawdza czas PRZED i PO rotacji RC (parametr ODSTƒòP_KOORDYNACJI_RC_RN = 3000s = 50 minut)</text>
  <text class="note" x="90" y="2755" style="white-space: pre;">‚Ä¢ Zapobiega konfliktom rotacji w oknie ¬±50min wok√≥≈Ç rotacji RC</text>
  <text class="note" x="90" y="2775" style="white-space: pre;">‚Ä¢ Zgodno≈õƒá z pseudokodem v1.7+ (src/algo_pseudokod.md, linia 1220-1232)</text>
</svg>

